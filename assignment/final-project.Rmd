---
title: "California ISO Electric Grid Data Analysis"
author: "Michaela Palmer &  Melissa Ferriter"
output: github_document
---

```{r setup, include=T}
knitr::opts_chunk$set(echo = T, warning = F, message = F)
```

```{r results='hide'}
libs <- c("tidyverse", "readxl", "ggpubr", "foreign")
sapply(libs, require, character.only=T)
```

## Read in data

The data used in this analysis comes from [California Independent System Operator Corporation (CAISO)](http://www.caiso.com/green/renewableswatch.html), which aggregates grid data from electricity producers in California.
```{r}
# create and view an object with file names and full paths
days <- c("01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31")
months <- c("01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12")
urls <- list()
for(i in months) {
  url <- paste0("http://content.caiso.com/green/renewrpt/2017", i, days, "_DailyRenewablesWatch.txt")
  urls[[paste0("month", i)]] <- url
}

```

```{r }
# function to import data with proper formatting & columns 
import <- function(data) {
  data.frame(date = as.Date(basename(data), "%Y%m%d"), read_table2( 
    data,
    col_names = c(
      "hour",
      "geothermal",
      "biomass",
      "biogas",
      "small_hydro",
      "wind",
      "solar_pv",
      "solar_thermal"
    ),
    skip = 2,
    n_max = 24
  )) 
}

jan <- do.call("rbind", lapply(urls[["month01"]], import))
feb <- do.call("rbind", lapply(urls[["month02"]], import))
march <- do.call("rbind", lapply(urls[["month03"]], import))
june <- do.call("rbind", lapply(urls[["month6"]], import))
july<- do.call("rbind", lapply(urls[["month07"]], import))
oct <- do.call("rbind", lapply(urls[["month10"]], import))

```

# Daily average data plots

The CAISO data are provided at hourly intervals. Plotting the data for the entire 6-year period would have generated a very messy graph, so I calculated daily means and plotted them instead.


```{r}
library(zoo)
#jan 2017 example plot
jan[, -c(2)] %>%
    read.zoo(FUN = identity) %>%
    aggregate(as.Date, mean) %>%
    fortify.zoo() %>%
    select(Index, geothermal, biomass, biogas, small_hydro, wind, solar_pv, solar_thermal) %>%
    gather(Renewable, mean, -Index) %>%
    ggplot() + 
    geom_line(mapping = aes(x= Index, y = mean, color = Renewable)) + labs(
    title = "January 2017 Daily Averages",
    x = "Date",
    y = "Production (MW)"
  )

```

```{r}
# other tested regex methods
#sapply(strsplit(filelist, "[/_]"), "[", 6)
#sub(".*(\\d{8}).*", "\\1", filelist)
#sub(".*/", "", sub("_.*", "", filelist))
#sub("_.*", "", basename(filelist))
#gsub("(?:.*/){4}([^_]+)_.*", "\\1", filelist)
```


